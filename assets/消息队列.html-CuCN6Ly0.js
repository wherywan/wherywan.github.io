import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as i,o as p,c as r,a as s,b as n,d as e,e as l}from"./app-hoN0JGLf.js";const o={},c=l('<h1 id="消息队列" tabindex="-1"><a class="header-anchor" href="#消息队列"><span>消息队列</span></a></h1><h2 id="需求" tabindex="-1"><a class="header-anchor" href="#需求"><span>需求</span></a></h2><ol><li>实现一个可供客户端订阅消息的消息队列服务器broker</li><li>协议选择： amqp或mqtt</li><li>是否落盘，提供持久化能力</li><li>是否提供消息最大保存时间设置</li><li>认证模块的实现</li><li>用户及队列信息的维护</li><li>如何处理客户端的连接、订阅、消息分配</li><li>消息消费位点如何处理</li></ol><h2 id="方案" tabindex="-1"><a class="header-anchor" href="#方案"><span>方案</span></a></h2><h3 id="基于jmqtt改造" tabindex="-1"><a class="header-anchor" href="#基于jmqtt改造"><span>基于jmqtt改造</span></a></h3>',5),d={href:"https://www.yuque.com/tristan-ku8np/zze",target:"_blank",rel:"noopener noreferrer"},h=s("h3",{id:"基于pulsar改造",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#基于pulsar改造"},[s("span",null,"基于pulsar改造")])],-1),u={href:"https://pulsar.apache.org/docs/3.3.x/security-oauth2/",target:"_blank",rel:"noopener noreferrer"},m=s("li",null,"使用oauth2认证",-1),b=l(`<h3 id="基于activemq改造" tabindex="-1"><a class="header-anchor" href="#基于activemq改造"><span>基于activemq改造</span></a></h3><h3 id="基于hivemq改造" tabindex="-1"><a class="header-anchor" href="#基于hivemq改造"><span>基于Hivemq改造</span></a></h3><h3 id="基于moquette改造" tabindex="-1"><a class="header-anchor" href="#基于moquette改造"><span>基于Moquette改造</span></a></h3><h3 id="基于qpid进行改造" tabindex="-1"><a class="header-anchor" href="#基于qpid进行改造"><span>基于qpid进行改造</span></a></h3><ul><li>amqp协议</li><li>jms</li></ul><h3 id="基于eclipse-paho-mqtt-broker改造" tabindex="-1"><a class="header-anchor" href="#基于eclipse-paho-mqtt-broker改造"><span>基于Eclipse Paho MQTT Broker改造</span></a></h3><ul><li>结合paho client</li></ul><h3 id="基于rabbitmq进行改造" tabindex="-1"><a class="header-anchor" href="#基于rabbitmq进行改造"><span>基于rabbitmq进行改造</span></a></h3><ul><li>使用rabbitmq-auth-backend-http插件</li><li>rabbit-mqtt插件</li><li>rabbitmq_amqp1_0插件</li></ul><h4 id="rabbitmq配置步骤" tabindex="-1"><a class="header-anchor" href="#rabbitmq配置步骤"><span>rabbitmq配置步骤</span></a></h4><blockquote><p>常用命令</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="shiki light-plus" style="background-color:#FFFFFF;color:#000000;" tabindex="0"><code><span class="line"><span style="color:#008000;"># 列出插件列表</span></span>
<span class="line"><span style="color:#795E26;">rabbitmq-pluins</span><span style="color:#A31515;"> list</span></span>
<span class="line"><span style="color:#008000;"># 启用插件</span></span>
<span class="line"><span style="color:#795E26;">rabbitmq-plugins</span><span style="color:#A31515;"> enable</span><span style="color:#A31515;"> rabbitmq_auth_backend_http</span></span>
<span class="line"><span style="color:#795E26;">rabbitmq-plugins</span><span style="color:#A31515;"> enable</span><span style="color:#A31515;"> rabbitmq_auth_backend_cache</span></span>
<span class="line"><span style="color:#008000;"># 查看环境参数</span></span>
<span class="line"><span style="color:#795E26;">rabbitmqctl</span><span style="color:#A31515;"> environment</span></span>
<span class="line"><span style="color:#008000;"># 配置参数</span></span>
<span class="line"><span style="color:#795E26;">vi</span><span style="color:#A31515;"> /etc/rabbitmq/rabbitmq.conf</span></span>
<span class="line"><span style="color:#008000;"># 重启</span></span>
<span class="line"><span style="color:#795E26;">service</span><span style="color:#A31515;"> rabbitmq-server</span><span style="color:#A31515;"> restart</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>配置http插件</p></blockquote><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><pre class="shiki light-plus" style="background-color:#FFFFFF;color:#000000;" tabindex="0"><code><span class="line"><span style="color:#008000;"># 1、2表示认证顺序</span></span>
<span class="line"><span style="color:#0000FF;">auth_backends.1</span><span style="color:#000000;"> = cache</span></span>
<span class="line"><span style="color:#0000FF;">auth_cache.cached_backend</span><span style="color:#000000;"> = http</span></span>
<span class="line"><span style="color:#0000FF;">auth_backends.2</span><span style="color:#000000;"> = internal</span></span>
<span class="line"><span style="color:#008000;"># auth_backends.2 = http</span></span>
<span class="line"><span style="color:#0000FF;">auth_http.http_method</span><span style="color:#000000;">   = post</span></span>
<span class="line"><span style="color:#0000FF;">auth_http.user_path</span><span style="color:#000000;">     = http://some-server/auth/user</span></span>
<span class="line"><span style="color:#0000FF;">auth_http.vhost_path</span><span style="color:#000000;">    = http://some-server/auth/vhost</span></span>
<span class="line"><span style="color:#0000FF;">auth_http.resource_path</span><span style="color:#000000;"> = http://some-server/auth/resource</span></span>
<span class="line"><span style="color:#0000FF;">auth_http.topic_path</span><span style="color:#000000;">    = http://some-server/auth/topic</span></span>
<span class="line"><span style="color:#0000FF;">auth_cache.cache_ttl</span><span style="color:#000000;"> = 5000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="rabbitmq-conf" tabindex="-1"><a class="header-anchor" href="#rabbitmq-conf"><span>rabbitmq.conf</span></a></h4><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><pre class="shiki light-plus" style="background-color:#FFFFFF;color:#000000;" tabindex="0"><code><span class="line"><span style="color:#008000;">#loopback_users.guest = false</span></span>
<span class="line"><span style="color:#008000;">#listeners.tcp.default = 5672</span></span>
<span class="line"><span style="color:#008000;">#default_pass = 123456</span></span>
<span class="line"><span style="color:#008000;">#default_user = admin</span></span>
<span class="line"><span style="color:#008000;">#management.listener.port = 15672</span></span>
<span class="line"><span style="color:#008000;">#management.listener.ssl = false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#008000;">#auth_backends.1 = cache</span></span>
<span class="line"><span style="color:#008000;"># 启用 cache 后，不需要直接指定 http 方式</span></span>
<span class="line"><span style="color:#0000FF;">auth_backends.1</span><span style="color:#000000;"> = http</span></span>
<span class="line"><span style="color:#0000FF;">auth_backends.2</span><span style="color:#000000;"> = internal</span></span>
<span class="line"><span style="color:#008000;"># 缓存后端指定为 http</span></span>
<span class="line"><span style="color:#008000;"># auth_cache.cached_backend = http</span></span>
<span class="line"><span style="color:#008000;"># 认证请求类型</span></span>
<span class="line"><span style="color:#0000FF;">auth_http.http_method</span><span style="color:#000000;">   = post</span></span>
<span class="line"><span style="color:#008000;"># 认证和授权地址，官方提供了 Spring Boot 示例</span></span>
<span class="line"><span style="color:#008000;"># 根据需要配置下面地址</span></span>
<span class="line"><span style="color:#0000FF;">auth_http.request_timeout</span><span style="color:#000000;"> = 60000</span></span>
<span class="line"><span style="color:#0000FF;">auth_http.connection_timeout</span><span style="color:#000000;"> = 60000</span></span>
<span class="line"><span style="color:#0000FF;">auth_http.user_path</span><span style="color:#000000;"> = http://10.142.52.12:3000/auth/user</span></span>
<span class="line"><span style="color:#0000FF;">auth_http.vhost_path</span><span style="color:#000000;"> = http://10.142.52.12:3000/auth/vhost</span></span>
<span class="line"><span style="color:#0000FF;">auth_http.resource_path</span><span style="color:#000000;"> = http://10.142.52.12:3000/auth/resource</span></span>
<span class="line"><span style="color:#0000FF;">auth_http.topic_path</span><span style="color:#000000;"> = http://10.142.52.12:3000/auth/topic</span></span>
<span class="line"><span style="color:#008000;"># 缓存时间，单位毫秒</span></span>
<span class="line"><span style="color:#0000FF;">auth_cache.cache_ttl</span><span style="color:#000000;"> = 1000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#0000FF;">mqtt.default_user</span><span style="color:#000000;"> = test</span></span>
<span class="line"><span style="color:#0000FF;">mqtt.default_pass</span><span style="color:#000000;"> = 123456</span></span>
<span class="line"><span style="color:#0000FF;">mqtt.allow_anonymous</span><span style="color:#000000;"> = true</span></span>
<span class="line"><span style="color:#0000FF;">mqtt.listeners.tcp.default</span><span style="color:#000000;"> = 1883</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,16);function v(y,_){const a=i("ExternalLinkIcon");return p(),r("div",null,[c,s("ul",null,[s("li",null,[s("a",d,[n("设计文档"),e(a)])])]),h,s("ul",null,[s("li",null,[s("a",u,[n("官方文档"),e(a)])]),m]),b])}const k=t(o,[["render",v],["__file","消息队列.html.vue"]]),g=JSON.parse('{"path":"/note/%E5%BA%94%E7%94%A8%E6%96%B9%E6%A1%88/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97.html","title":"消息队列","lang":"zh-CN","frontmatter":{"description":"消息队列 需求 实现一个可供客户端订阅消息的消息队列服务器broker 协议选择： amqp或mqtt 是否落盘，提供持久化能力 是否提供消息最大保存时间设置 认证模块的实现 用户及队列信息的维护 如何处理客户端的连接、订阅、消息分配 消息消费位点如何处理 方案 基于jmqtt改造 设计文档 基于pulsar改造 官方文档 使用oauth2认证 基于a...","head":[["meta",{"property":"og:url","content":"https://wherywan.github.io/note/%E5%BA%94%E7%94%A8%E6%96%B9%E6%A1%88/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97.html"}],["meta",{"property":"og:site_name","content":"HONG_JI"}],["meta",{"property":"og:title","content":"消息队列"}],["meta",{"property":"og:description","content":"消息队列 需求 实现一个可供客户端订阅消息的消息队列服务器broker 协议选择： amqp或mqtt 是否落盘，提供持久化能力 是否提供消息最大保存时间设置 认证模块的实现 用户及队列信息的维护 如何处理客户端的连接、订阅、消息分配 消息消费位点如何处理 方案 基于jmqtt改造 设计文档 基于pulsar改造 官方文档 使用oauth2认证 基于a..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-05T09:51:07.000Z"}],["meta",{"property":"article:author","content":"wanhongji"}],["meta",{"property":"article:modified_time","content":"2024-08-05T09:51:07.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"消息队列\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-08-05T09:51:07.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"wanhongji\\"}]}"]]},"headers":[{"level":2,"title":"需求","slug":"需求","link":"#需求","children":[]},{"level":2,"title":"方案","slug":"方案","link":"#方案","children":[{"level":3,"title":"基于jmqtt改造","slug":"基于jmqtt改造","link":"#基于jmqtt改造","children":[]},{"level":3,"title":"基于pulsar改造","slug":"基于pulsar改造","link":"#基于pulsar改造","children":[]},{"level":3,"title":"基于activemq改造","slug":"基于activemq改造","link":"#基于activemq改造","children":[]},{"level":3,"title":"基于Hivemq改造","slug":"基于hivemq改造","link":"#基于hivemq改造","children":[]},{"level":3,"title":"基于Moquette改造","slug":"基于moquette改造","link":"#基于moquette改造","children":[]},{"level":3,"title":"基于qpid进行改造","slug":"基于qpid进行改造","link":"#基于qpid进行改造","children":[]},{"level":3,"title":"基于Eclipse Paho MQTT Broker改造","slug":"基于eclipse-paho-mqtt-broker改造","link":"#基于eclipse-paho-mqtt-broker改造","children":[]},{"level":3,"title":"基于rabbitmq进行改造","slug":"基于rabbitmq进行改造","link":"#基于rabbitmq进行改造","children":[]}]}],"git":{"createdTime":1691080027000,"updatedTime":1722851467000,"contributors":[{"name":"wanhongji","email":"wheywan@163.com","commits":3},{"name":"wanhongji","email":"wherywan@163.com","commits":2}]},"readingTime":{"minutes":1.37,"words":411},"filePathRelative":"note/应用方案/消息队列.md","localizedDate":"2023年8月3日","excerpt":"\\n<h2>需求</h2>\\n<ol>\\n<li>实现一个可供客户端订阅消息的消息队列服务器broker</li>\\n<li>协议选择： amqp或mqtt</li>\\n<li>是否落盘，提供持久化能力</li>\\n<li>是否提供消息最大保存时间设置</li>\\n<li>认证模块的实现</li>\\n<li>用户及队列信息的维护</li>\\n<li>如何处理客户端的连接、订阅、消息分配</li>\\n<li>消息消费位点如何处理</li>\\n</ol>\\n<h2>方案</h2>\\n<h3>基于jmqtt改造</h3>\\n<ul>\\n<li><a href=\\"https://www.yuque.com/tristan-ku8np/zze\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">设计文档</a></li>\\n</ul>","autoDesc":true}');export{k as comp,g as data};
